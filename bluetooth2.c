#include<pic.h>
#define _XTAL_FREQ 8000000
__CONFIG(0X2CE4);
#define relay_1 RB0
#define relay_2 RB1
#define relay_3 RB2
#define relay_4 RB3
#define led_1 RA0
#define led_2 RA1
#define led_3 RA2
#define led_4 RA3
unsigned int y;unsigned int c=0;
void delay(unsigned int a)
{
while(a--);
}
void tx(const char x)
{
TXREG=x;
while(TXIF==0);
TXIF=0;
}
void time()
{
if(TMR1IF==1)
{
c++;
TMR1IF=0;
}
}
void interrupt rc()
{
while(RCIF==0);
y=RCREG;
RCIF=0;
}
void init()
{
PR2=0xff;
//TMR2=0;
T2CON=0x05;
CCP1CON=0x0D;
CCP2CON=0x0f;
}
void mduty(unsigned int duty)
{
CCPR1L=duty>>2;
CCP1CON=0xCF&CCP1CON;
CCP1CON=(((duty<<4)&0x30)|(CCP1CON));
}
void main()
{
PORTA=0x00;
TRISA=0x00;
PORTC=0x00;
TRISC=0x00;
PORTB=0x00;
TRISB=0x00;
ANSEL=0x00;
ANSELH=0x00;
T1CON=0X31;
TXSTA=0x24;
RCSTA=0x90;
SPBRG=25;
INTCON|=0b11000000;
PIE1=0b00100000;
init();
while(1)
{
time();
if(y=='a')
{
relay_1=1;
led_1=1;
}
if(y=='b')
{
relay_1=0;
led_1=0;
}
if(y=='c')
{
relay_2=1;
led_2=1;
}
if(y=='d')
{
relay_2=0;
led_2=0;
}
if(y=='e')
{
relay_3=1;
led_3=1;
}
if(y=='f')
{
relay_3=0;
led_3=0;
}
if(y=='g')
{
relay_4=1;
led_4=1;
}
if(y=='h')
{
relay_4=0;
led_4=0;
}
if(y=='i')
{
relay_1=0;
relay_2=0;
relay_3=0;
relay_4=0;
led_1=0;
led_2=0;
led_3=0;
led_4=0;
c=0;
}
if(y=='j')
{
if(c<=240)
{
led_1=1;
relay_1=1;
}
if(c>240)
{
led_1=0;
relay_1=0;
y=1;
}
}
if(y==1)
{
c=0;
}
if(y=='k')
{
if(c<=600)
{
led_1=1;
relay_1=1;
}
if(c>600)
{
led_1=0;
relay_1=0;
y=2;
}
}
if(y==2)
{
c=0;
}
if(y=='l')
{
if(c<=240)
{
led_2=1;
relay_2=1;
}
if(c>240)
{
led_2=0;
relay_2=0;
y=3;
}
}
if(y==3)
{
c=0;
}
if(y=='m')
{
if(c<=600)
{
led_2=1;
relay_2=1;
}
if(c>600)
{
led_2=0;
relay_2=0;
y=4;
}
}
if(y==4)
{
c=0;
}
if(y=='n')
{
if(c<=240)
{
led_3=1;
relay_3=1;
}
if(c>240)
{
led_3=0;
relay_3=0;
y=5;
}
}
if(y==5)
{
c=0;
}
if(y=='o')
{
if(c<=600)
{
led_3=1;
relay_3=1;
}
if(c>600)
{
led_3=0;
relay_3=0;
y=6;
}
}
if(y==6)
{
c=0;
}
if(y=='p')
{
if(c<=240)
{
led_4=1;
relay_4=1;
}
if(c>240)
{
led_4=0;
relay_4=0;
y=7;
}
}
if(y==7)
{
c=0;
}
if(y=='q')
{
if(c<=600)
{
led_4=1;
relay_4=1;
}
if(c>600)
{
led_4=0;
relay_4=0;
y=8;
}
}
if(y==8)
{
c=0;
}
if(y=='1')
{
mduty(25);
}
if(y=='2')
{
mduty(100);
}
if(y=='3')
{
mduty(255);
}
if(y=='4')
{
mduty(300);
}
if(y=='5')
{
mduty(400);
}

}
}